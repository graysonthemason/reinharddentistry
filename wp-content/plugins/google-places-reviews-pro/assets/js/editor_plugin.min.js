!function(){tinymce.PluginManager.add("gpr_shortcode_button",function(a,b){function c(b,c){a.windowManager.open({title:h.getLang("gpr.shortcode_generator_title"),id:"gpr_shortcode_dialog",width:600,height:450,resizable:!0,scrollbars:!0,url:ajaxurl+"?action=gpr_shortcode_iframe"},{shortcode:h.getLang("gpr.shortcode_tag"),shortcode_params:window.decodeURIComponent(c)})}function d(a,b){return b=new RegExp(b+'="([^"]+)"',"g").exec(a),b?window.decodeURIComponent(b[1]):""}function e(a){return a.replace(/\[google-places-reviews([^\]]*)\]/g,function(a,b,c){return g("wp-google-places-reviews",b,c)})}function f(a){return a.replace(/(?:<p(?: [^>]+)?>)*(<img [^>]+>)(<\/p>)*/g,function(a,b){var c=d(b,"data-gpr-attr");return c?"<p>["+i+c+"]</p>":a})}function g(a,c){var d=b+"/shortcode-placeholder.jpg";return c=window.encodeURIComponent(c),'<img src="'+d+'" class="mceItem '+a+'" data-gpr-attr="'+c+'" data-mce-resize="false" data-mce-placeholder="1" />'}var h=tinymce.activeEditor,i="google-places-reviews";a.addCommand("gpr_shortcode_popup",c),a.addButton("gpr_shortcode_button",{title:h.getLang("gpr.shortcode_generator_title"),icon:"gpr dashicons-location",onclick:c}),a.on("BeforeSetcontent",function(a){a.content=e(a.content)}),a.on("GetContent",function(a){a.content=f(a.content)}),a.on("DblClick",function(b){var c=b.target.className.indexOf("wp-google-places-reviews"),d=b.target.attributes["data-gpr-attr"].value;"IMG"==b.target.nodeName&&c>-1&&a.execCommand("gpr_shortcode_popup",!1,d)})})}();
